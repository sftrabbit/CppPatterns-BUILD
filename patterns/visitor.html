<!doctype html>
<html>
	<head>
		<title>Visitor - C++ Samples</title>
		<meta charset="utf-8">
		<meta name="description" content="Separate generic algorithms from the elements or structure on which
they operate.

">
		<meta name="viewport" content="width=device-width,user-scalable=no">
		<link rel="canonical" href="http://www.cppsamples.com/patterns/visitor.html">
		<link rel="icon" sizes="16x16" type="image/vnd.microsoft.icon" href="http://www.cppsamples.com/images/icon-16.ico">
		<link rel="icon" sizes="32x32" type="image/vnd.microsoft.icon" href="http://www.cppsamples.com/images/icon-32.ico">
		<link href="http://fonts.googleapis.com/css?family=Roboto:400italic,100,700italic,700,400|Roboto+Slab|Ubuntu+Mono" rel="stylesheet" type="text/css">
		<link href="http://www.cppsamples.com/css/screen.css" rel="stylesheet" type="text/css">

		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<script async defer src="https://apis.google.com/js/platform.js"></script>

		<meta name="twitter:card" content="summary">
		<meta name="twitter:creator" content="@sftrabbit">
		<meta property="og:title" content="Visitor - C++ Samples">
		<meta property="og:site_name" content="C++ Samples">
		<meta property="og:url" content="http://www.cppsamples.com/patterns/visitor.html">
		<meta property="og:description" content="Separate generic algorithms from the elements or structure on which
they operate.

">
		<meta property="fb:app_id" content="676162015844286">
	</head>
	<body>
		<header>
			<div class="container">
				<div class="row">
					<div class="column-4">
						<h1><a href="http://www.cppsamples.com/"><span>C++</span>​Samples</a></h1>
						<p>A repository of modern C++ code samples curated by the community.</p>
					</div>
				</div>
			</div>
		</header>
		<main class="container">
			<div class="row disclaimer">
				<div class="column-4">
					<p>C++ Samples was launched on 6th April 2015 and the existing samples are still under review. If you notice any mistakes or would like to contribute additional samples, please leave comments or <a href="https://github.com/sftrabbit/CppSamples-Samples">fork the sample repository</a>.</p>
				</div>
			</div>
			<script>
var selected = false;

function apply_to_lines(lineRefElement, callback) {
	var lineNumStart = parseInt(lineRefElement.dataset.line);
	var lineNumEnd = lineNumStart;
	if (lineRefElement.dataset.lineEnd) {
		var lineNumEnd = parseInt(lineRefElement.dataset.lineEnd);
	}
	for (var i = lineNumStart; i <= lineNumEnd; i++) {
		var lineElement = document.getElementById('line'+i);
		callback(lineElement);
	}
}

function clear_all() {
	var i = 1;
	var lineElement;
	while (lineElement = document.getElementById('line'+i)) {
		lineElement.style.backgroundColor = "transparent";
		i++;
	}
}

document.addEventListener('DOMContentLoaded', function() {
	document.onclick = function(event) {
		clear_all();
	}

	var lineRefElements = document.getElementsByClassName('lineref');
	for (var i = 0; i < lineRefElements.length; i++) {
		lineRefElements[i].onclick = function(event) {
			clear_all();
			apply_to_lines(event.target, function(lineElement) {
				lineElement.style.backgroundColor = "rgb(76, 69, 41)";
			});
			event.stopPropagation();
		}
		lineRefElements[i].onmouseover = function(event) {
			apply_to_lines(event.target, function(lineElement) {
				if (lineElement.style.backgroundColor != "rgb(76, 69, 41)") {
					lineElement.style.backgroundColor = "rgb(69, 69, 69)";
				}
			});
			event.stopPropagation();
		}
		lineRefElements[i].onmouseout = function(event) {
			apply_to_lines(event.target, function(lineElement) {
				if (lineElement.style.backgroundColor != "rgb(76, 69, 41)") {
					lineElement.style.backgroundColor = "transparent";
				}
			});
			event.stopPropagation();
		}
	}
}, false);
			</script>
			<section class="sample">
				<div class="row">
					<div class="column-4">
						<a href="http://www.cppsamples.com/">← Samples</a>
						<h1>Visitor</h1>
					</div>
				</div>
				<div class="row">
					<div class="column-2">
						<table class="codeblock"><tr><td class="linenums"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</code></pre></td><td class="code highlight"><pre><code class="cpp"><span class="codeline" id="line1"><span class="k">class</span> <span class="nc">element_concrete_1</span><span class="p">;</span></span>
<span class="codeline" id="line2"><span class="k">class</span> <span class="nc">element_concrete_2</span><span class="p">;</span></span>
<span class="codeline" id="line3"></span>
<span class="codeline" id="line4"><span class="k">class</span> <span class="nc">visitor</span></span>
<span class="codeline" id="line5"><span class="p">{</span></span>
<span class="codeline" id="line6">	<span class="k">public</span><span class="o">:</span></span>
<span class="codeline" id="line7">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">visit</span><span class="p">(</span><span class="n">element_concrete_1</span><span class="o">&amp;</span> <span class="n">el</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></span>
<span class="codeline" id="line8">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">visit</span><span class="p">(</span><span class="n">element_concrete_2</span><span class="o">&amp;</span> <span class="n">el</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></span>
<span class="codeline" id="line9"><span class="p">};</span></span>
<span class="codeline" id="line10"></span>
<span class="codeline" id="line11"><span class="k">class</span> <span class="nc">visitor_concrete</span> <span class="o">:</span> <span class="k">public</span> <span class="n">visitor</span></span>
<span class="codeline" id="line12"><span class="p">{</span></span>
<span class="codeline" id="line13">	<span class="k">public</span><span class="o">:</span></span>
<span class="codeline" id="line14">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">visit</span><span class="p">(</span><span class="n">element_concrete_1</span><span class="o">&amp;</span> <span class="n">el</span><span class="p">)</span> <span class="k">override</span></span>
<span class="codeline" id="line15">		<span class="p">{</span></span>
<span class="codeline" id="line16">			<span class="c1">// Do something with el</span></span>
<span class="codeline" id="line17">		<span class="p">};</span></span>
<span class="codeline" id="line18">		</span>
<span class="codeline" id="line19">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">visit</span><span class="p">(</span><span class="n">element_concrete_2</span><span class="o">&amp;</span> <span class="n">el</span><span class="p">)</span> <span class="k">override</span></span>
<span class="codeline" id="line20">		<span class="p">{</span></span>
<span class="codeline" id="line21">			<span class="c1">// Do something with b</span></span>
<span class="codeline" id="line22">		<span class="p">};</span></span>
<span class="codeline" id="line23"><span class="p">};</span></span>
<span class="codeline" id="line24"></span>
<span class="codeline" id="line25"></span>
<span class="codeline" id="line26"><span class="k">class</span> <span class="nc">element</span></span>
<span class="codeline" id="line27"><span class="p">{</span></span>
<span class="codeline" id="line28">	<span class="k">public</span><span class="o">:</span></span>
<span class="codeline" id="line29">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">accept</span><span class="p">(</span><span class="n">visitor</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></span>
<span class="codeline" id="line30"><span class="p">};</span></span>
<span class="codeline" id="line31"></span>
<span class="codeline" id="line32"><span class="k">class</span> <span class="nc">element_concrete_1</span> <span class="o">:</span> <span class="k">public</span> <span class="n">element</span></span>
<span class="codeline" id="line33"><span class="p">{</span></span>
<span class="codeline" id="line34">	<span class="k">public</span><span class="o">:</span></span>
<span class="codeline" id="line35">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">accept</span><span class="p">(</span><span class="n">visitor</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="k">override</span></span>
<span class="codeline" id="line36">		<span class="p">{</span></span>
<span class="codeline" id="line37">			<span class="n">v</span><span class="p">.</span><span class="n">visit</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span></span>
<span class="codeline" id="line38">		<span class="p">}</span></span>
<span class="codeline" id="line39"><span class="p">};</span></span>
<span class="codeline" id="line40"></span>
<span class="codeline" id="line41"><span class="k">class</span> <span class="nc">element_concrete_2</span> <span class="o">:</span> <span class="k">public</span> <span class="n">element</span></span>
<span class="codeline" id="line42"><span class="p">{</span></span>
<span class="codeline" id="line43">	<span class="k">public</span><span class="o">:</span></span>
<span class="codeline" id="line44">		<span class="k">virtual</span> <span class="kt">void</span> <span class="n">accept</span><span class="p">(</span><span class="n">visitor</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="k">override</span></span>
<span class="codeline" id="line45">		<span class="p">{</span></span>
<span class="codeline" id="line46">			<span class="n">v</span><span class="p">.</span><span class="n">visit</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span></span>
<span class="codeline" id="line47">		<span class="p">}</span></span>
<span class="codeline" id="line48"><span class="p">};</span></span></code></pre></td></tr></table>
						<p class="license">This sample is licensed under the <a href="http://creativecommons.org/publicdomain/zero/1.0/">CC0 Public Domain Dedication</a>.</p>
					</div>
					<div class="column-2">
						<h2>Intent</h2>
						<p>Separate generic algorithms from the elements or structure on which
they operate.</p>


						<h2>Description</h2>
						<p>The visitor pattern allows generic algorithms to be implemented 
without modifying the objects on which they operate and supports
different actions for each type of object without the need for
dynamic casting.</p>

<p>The <code>element</code> class, defined on <a href="#line26" class="lineref" data-line="26" data-line-end="30">lines 26–30</a>, defines an interface that
allows an object to accept a visitor. Each class derived from
<code>element</code>, such as those on <a href="#line32" class="lineref" data-line="32" data-line-end="48">lines 32–48</a>, implements the <code>accept</code>
function such that it calls the appropriate <code>visit</code> function on the
visitor.</p>

<p>Visitors, which implement the <code>visitor</code> interface (<a href="#line4" class="lineref" data-line="4" data-line-end="9">lines 4–9</a>),
represent algorithms to be applied to <code>element</code>s. The visitor
interface defines <code>visit</code> overloads for each type of <code>element</code>. An
example <code>visitor</code> is defined on <a href="#line11" class="lineref" data-line="11" data-line-end="23">lines 11–23</a>.</p>

<p>When a <code>visitor</code> visits an <code>element</code>, two function calls are made
(one to <code>accept</code> and one to <code>visit</code>) and the final <code>visit</code> function
that is called depends on the type of both the <code>element</code> and the
<code>visitor</code>. This process is known as <em>double dispatch</em>.</p>

<p>The visitor pattern is particularly useful when the <code>element</code>s are
part of a larger structure, in which case the <code>accept</code> function can
call itself recursively down the structure.</p>

						<div class="subrow">
							<div class="column-1">
								<h2>Contributors</h2>
								<ul class="contributors">

									<li><a title="Joseph Mansfield" href="https://github.com/sftrabbit"><img src="https://avatars.githubusercontent.com/u/32490?v=3&size=36" alt="Joseph Mansfield"></a></li>

									<li><a title="Evert Timberg" href="https://github.com/etimberg"><img src="https://avatars.githubusercontent.com/u/6757853?v=3&size=36" alt="Evert Timberg"></a></li>

								</ul>
								<h2>Last Updated</h2>
								<p>09 April 2015</p>
								<h2>Source</h2>
								<p><a href="https://github.com/sftrabbit/CppSamples-Samples/tree/master/2-patterns/behavioral/visitor.cpp">Fork this sample on GitHub</a></p>
							</div>
							<div class="column-1">
								<h2>Share</h2>
								<p><div class="fb-like" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div></p>
								<p><a href="https://twitter.com/share" class="twitter-share-button" data-via="sftrabbit" data-dnt="true">Tweet</a></p>
								<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
								<div class="g-plusone" data-size="medium"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="column-4">
						<div id="disqus_thread"></div>
						<script type="text/javascript">
var disqus_shortname = 'cppsamples';

(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
						</script>

						<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6789411983750873" data-ad-slot="5581833133" data-ad-format="auto"></ins>

					</div>
				</div>
			</section>

		</main>
		<footer class="container">
			<div class="row">
				<div class="column-2">
					<p>Feel like <b>contributing</b>? This website is generated from a git repository. If you have something to add or have noticed a mistake, please <a href="https://github.com/sftrabbit/CppSamples-Samples">fork the project on GitHub</a>.</p>
					<p><div class="fb-like" data-href="http://www.cppsamples.com/" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div></p>
					<p><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.cppsamples.com/" data-text="Modern and idiomatic C++ code from C++ Samples" data-via="sftrabbit" data-dnt="true">Tweet</a></p>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
					<div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://www.cppsamples.com/"></div>
				</div>
				<div class="column-1 offset-1 about">
					<img src="http://josephmansfield.uk/images/logo.svg">
					<p>C++ Samples created by <a href="http://josephmansfield.uk/">Joseph Mansfield</a></p>
				</div>
			</div>
		</footer>
		<script>
adsbygoogle = window.adsbygoogle || [];
adsbygoogle.push({});

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17335804-5', 'auto');
ga('send', 'pageview');

window.fbAsyncInit = function() {
  FB.init({
    appId      : '676162015844286',
    xfbml      : true,
    version    : 'v2.3'
  });
};

(function(d, s, id){
   var js, fjs = d.getElementsByTagName(s)[0];
   if (d.getElementById(id)) {return;}
   js = d.createElement(s); js.id = id;
   js.src = "//connect.facebook.net/en_US/sdk.js";
   fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
		</script>
	</body>
</html>
