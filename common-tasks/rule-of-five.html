<!doctype html>
<html>
	<head>
		<title>The rule of five - C++ Samples</title>
		<meta charset="utf-8">
		<meta name="description" content="Safely and efficiently implement RAII to encapsulate the
management of dynamically allocated resources.

">
		<meta name="viewport" content="width=device-width,user-scalable=no">
		<link rel="canonical" href="http://www.cppsamples.com/common-tasks/rule-of-five.html">
		<link rel="icon" sizes="16x16" type="image/vnd.microsoft.icon" href="http://www.cppsamples.com/images/icon-16.ico">
		<link rel="icon" sizes="32x32" type="image/vnd.microsoft.icon" href="http://www.cppsamples.com/images/icon-32.ico">
		<link href="http://fonts.googleapis.com/css?family=Roboto:400italic,100,700italic,700,400|Roboto+Slab|Ubuntu+Mono" rel="stylesheet" type="text/css">
		<link href="http://www.cppsamples.com/css/screen.css" rel="stylesheet" type="text/css">
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

		<meta name="twitter:card" content="summary">
		<meta name="twitter:creator" content="@sftrabbit">
		<meta property="og:title" content="The rule of five - C++ Samples">
		<meta property="og:site_name" content="C++ Samples">
		<meta property="og:url" content="http://www.cppsamples.com/common-tasks/rule-of-five.html">
		<meta property="og:description" content="Safely and efficiently implement RAII to encapsulate the
management of dynamically allocated resources.

">
		<meta property="fb:app_id" content="676162015844286">
	</head>
	<body>
		<header>
			<div class="container">
				<div class="row">
					<div class="column-4">
						<h1><a href="http://www.cppsamples.com/"><span>C++</span>​Samples</a></h1>
						<p>A repository of modern C++ code samples curated by the community.</p>
					</div>
				</div>
			</div>
		</header>
		<main class="container">
			<div class="row disclaimer">
				<div class="column-4">
					<p>C++ Samples was launched on 6th April 2015 and the existing samples are still under review. If you notice any mistakes or would like to contribute additional samples, please leave comments or <a href="https://github.com/sftrabbit/CppSamples-Samples">fork the sample repository</a>.</p>
				</div>
			</div>
			<script>
var selected = false;

function apply_to_lines(lineRefElement, callback) {
	var lineNumStart = parseInt(lineRefElement.dataset.line);
	var lineNumEnd = lineNumStart;
	if (lineRefElement.dataset.lineEnd) {
		var lineNumEnd = parseInt(lineRefElement.dataset.lineEnd);
	}
	for (var i = lineNumStart; i <= lineNumEnd; i++) {
		var lineElement = document.getElementById('line'+i);
		callback(lineElement);
	}
}

function clear_all() {
	var i = 1;
	var lineElement;
	while (lineElement = document.getElementById('line'+i)) {
		lineElement.style.backgroundColor = "transparent";
		i++;
	}
}

document.addEventListener('DOMContentLoaded', function() {
	document.onclick = function(event) {
		clear_all();
	}

	var lineRefElements = document.getElementsByClassName('lineref');
	for (var i = 0; i < lineRefElements.length; i++) {
		lineRefElements[i].onclick = function(event) {
			clear_all();
			apply_to_lines(event.target, function(lineElement) {
				lineElement.style.backgroundColor = "rgb(76, 69, 41)";
			});
			event.stopPropagation();
		}
		lineRefElements[i].onmouseover = function(event) {
			apply_to_lines(event.target, function(lineElement) {
				if (lineElement.style.backgroundColor != "rgb(76, 69, 41)") {
					lineElement.style.backgroundColor = "rgb(69, 69, 69)";
				}
			});
			event.stopPropagation();
		}
		lineRefElements[i].onmouseout = function(event) {
			apply_to_lines(event.target, function(lineElement) {
				if (lineElement.style.backgroundColor != "rgb(76, 69, 41)") {
					lineElement.style.backgroundColor = "transparent";
				}
			});
			event.stopPropagation();
		}
	}
}, false);
			</script>
			<section class="sample">
				<div class="row">
					<div class="column-4">
						<a href="http://www.cppsamples.com/">← Samples</a>
						<h1>The rule of five</h1>
					</div>
				</div>
				<div class="row">
					<div class="column-2">
						<table class="codeblock"><tr><td class="linenums"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</code></pre></td><td class="code highlight"><pre><code class="cpp"><span class="codeline" id="line1"><span class="cp">#include &lt;utility&gt;</span></span>
<span class="codeline" id="line2"></span>
<span class="codeline" id="line3"><span class="k">class</span> <span class="nc">resource</span> <span class="p">{</span></span>
<span class="codeline" id="line4">	<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></span>
<span class="codeline" id="line5"><span class="p">};</span></span>
<span class="codeline" id="line6"></span>
<span class="codeline" id="line7"><span class="k">class</span> <span class="nc">foo</span></span>
<span class="codeline" id="line8"><span class="p">{</span></span>
<span class="codeline" id="line9">	<span class="k">public</span><span class="o">:</span></span>
<span class="codeline" id="line10">		<span class="n">foo</span><span class="p">()</span></span>
<span class="codeline" id="line11">			<span class="o">:</span> <span class="n">p</span><span class="p">{</span><span class="k">new</span> <span class="n">resource</span><span class="p">{}}</span></span>
<span class="codeline" id="line12">		<span class="p">{</span> <span class="p">}</span></span>
<span class="codeline" id="line13"></span>
<span class="codeline" id="line14">		<span class="n">foo</span><span class="p">(</span><span class="k">const</span> <span class="n">foo</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span></span>
<span class="codeline" id="line15">			<span class="o">:</span> <span class="n">p</span><span class="p">{</span><span class="k">new</span> <span class="n">resource</span><span class="p">{</span><span class="o">*</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">p</span><span class="p">)}}</span></span>
<span class="codeline" id="line16">		<span class="p">{</span> <span class="p">}</span></span>
<span class="codeline" id="line17"></span>
<span class="codeline" id="line18">		<span class="n">foo</span><span class="p">(</span><span class="n">foo</span><span class="o">&amp;&amp;</span> <span class="n">other</span><span class="p">)</span></span>
<span class="codeline" id="line19">			<span class="o">:</span> <span class="n">p</span><span class="p">{</span><span class="n">other</span><span class="p">.</span><span class="n">p</span><span class="p">}</span></span>
<span class="codeline" id="line20">		<span class="p">{</span></span>
<span class="codeline" id="line21">			<span class="n">other</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span></span>
<span class="codeline" id="line22">		<span class="p">}</span></span>
<span class="codeline" id="line23"></span>
<span class="codeline" id="line24">		<span class="n">foo</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">foo</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span></span>
<span class="codeline" id="line25">		<span class="p">{</span></span>
<span class="codeline" id="line26">			<span class="k">if</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">other</span> <span class="o">!=</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span></span>
<span class="codeline" id="line27">				<span class="k">delete</span> <span class="n">p</span><span class="p">;</span></span>
<span class="codeline" id="line28">				<span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">resource</span><span class="p">{</span><span class="o">*</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">p</span><span class="p">)};</span></span>
<span class="codeline" id="line29">			<span class="p">}</span></span>
<span class="codeline" id="line30"></span>
<span class="codeline" id="line31">			<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span></span>
<span class="codeline" id="line32">		<span class="p">}</span></span>
<span class="codeline" id="line33"></span>
<span class="codeline" id="line34">		<span class="n">foo</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">foo</span><span class="o">&amp;&amp;</span> <span class="n">other</span><span class="p">)</span></span>
<span class="codeline" id="line35">		<span class="p">{</span></span>
<span class="codeline" id="line36">			<span class="k">if</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">other</span> <span class="o">!=</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span></span>
<span class="codeline" id="line37">				<span class="k">delete</span> <span class="n">p</span><span class="p">;</span></span>
<span class="codeline" id="line38">				<span class="n">p</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">p</span><span class="p">;</span></span>
<span class="codeline" id="line39">				<span class="n">other</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span></span>
<span class="codeline" id="line40">			<span class="p">}</span></span>
<span class="codeline" id="line41"></span>
<span class="codeline" id="line42">			<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span></span>
<span class="codeline" id="line43">		<span class="p">}</span></span>
<span class="codeline" id="line44"></span>
<span class="codeline" id="line45">		<span class="o">~</span><span class="n">foo</span><span class="p">()</span></span>
<span class="codeline" id="line46">		<span class="p">{</span></span>
<span class="codeline" id="line47">			<span class="k">delete</span> <span class="n">p</span><span class="p">;</span></span>
<span class="codeline" id="line48">		<span class="p">}</span></span>
<span class="codeline" id="line49"></span>
<span class="codeline" id="line50">	<span class="k">private</span><span class="o">:</span></span>
<span class="codeline" id="line51">		<span class="n">resource</span><span class="o">*</span> <span class="n">p</span><span class="p">;</span></span>
<span class="codeline" id="line52"><span class="p">};</span></span></code></pre></td></tr></table>
						<p class="license">This sample is licensed under the <a href="http://creativecommons.org/publicdomain/zero/1.0/">CC0 Public Domain Dedication</a>.</p>
					</div>
					<div class="column-2">
						<h2>Intent</h2>
						<p>Safely and efficiently implement RAII to encapsulate the
management of dynamically allocated resources.</p>


						<h2>Description</h2>
						<p>Firstly, the <em>rule of three</em> specifies that if a class implements
any of the following functions, it should implement all of them:</p>

<ul>
  <li>copy constructor</li>
  <li>copy assignment operator</li>
  <li>destructor</li>
</ul>

<p>These functions are usually required only when a class is manually
managing a dynamically allocated resource, and so all of them must
be implemented to manage the resource safely.</p>

<p>In addition, the <em>rule of five</em> identifies that it usually
appropriate to also provide the following functions to allow for
optimized copies from temporary objects:</p>

<ul>
  <li>move constructor</li>
  <li>move assignment operator</li>
</ul>

<p>The class <code>foo</code>, on <a href="#line7" class="lineref" data-line="7" data-line-end="52">lines 7–52</a>, dynamically allocates a <code>resource</code>
object in its constructor. The implementations of <code>foo</code>’s
copy constructor (<a href="#line14" class="lineref" data-line="14" data-line-end="16">lines 14–16</a>), copy assignment operator (<a href="#line24" class="lineref" data-line="24" data-line-end="32">lines 24–32</a>),
and destructor (<a href="#line45" class="lineref" data-line="45" data-line-end="48">lines 45–48</a>) ensure that the lifetime of this
resource is safely managed by <code>foo</code> object that contains it,
even in the event of an exception.</p>

<p>We have also implemented a move constructor (<a href="#line18" class="lineref" data-line="18" data-line-end="22">lines 18–22</a>) and
move assignment operator (<a href="#line34" class="lineref" data-line="34" data-line-end="43">lines 34–43</a>) that provide optimized copies
from temporary objects. Rather than copy the resource, they
take the resource from the original <code>foo</code> and set its 
internal pointer to <code>nullptr</code>, effectively stealing the resource.</p>

<p>Notice that the assignment operators (<a href="#line24" class="lineref" data-line="24" data-line-end="43">lines 24–43</a>) check for
self-assignment to ensure that there are no bugs.</p>

<p><strong>Note</strong>: The copy and move assignment operators may be
alternatively implemented with the copy-and-swap idiom.</p>

<p><strong>Note</strong>: We can typically avoid manual memory management and
having to write the copy constructor, assignment operator, and
destructor entirely by using the
<a href="/common-tasks/rule-of-zero.html">rule of zero</a></p>

						<div class="subrow">
							<div class="column-1">
								<h2>Contributors</h2>
								<ul class="contributors">

									<li><a title="Joseph Mansfield" href="https://github.com/sftrabbit"><img src="https://avatars.githubusercontent.com/u/32490?v=3&size=36" alt="Joseph Mansfield"></a></li>

								</ul>
							</div>
							<div class="column-1">
								<h2>Last Updated</h2>
								<p>07 April 2015</p>
							</div>
						</div>
						<div class="subrow">
							<div class="column-1">
								<h2>Source</h2>
								<p><a href="https://github.com/sftrabbit/CppSamples-Samples/tree/master/1-common-tasks/classes/rule-of-five.cpp">Fork this sample on GitHub</a></p>
							</div>
							<div class="column-1">
								<h2>Share</h2>
								<p><div class="fb-like" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div></p>
								<p><a href="https://twitter.com/share" class="twitter-share-button" data-via="sftrabbit" data-dnt="true">Tweet</a></p>
								<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="column-4">
						<div id="disqus_thread"></div>
						<script type="text/javascript">
var disqus_shortname = 'cppsamples';

(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
						</script>

						<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6789411983750873" data-ad-slot="5581833133" data-ad-format="auto"></ins>

					</div>
				</div>
			</section>

		</main>
		<footer class="container">
			<div class="row">
				<div class="column-2">
					<p>Feel like <b>contributing</b>? This website is generated from a git repository. If you have something to add or have noticed a mistake, please <a href="https://github.com/sftrabbit/CppSamples-Samples">fork the project on GitHub</a>.</p>
					<p><div class="fb-like" data-href="http://www.cppsamples.com/" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div></p>
					<p><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.cppsamples.com/" data-text="Modern and idiomatic C++ code from C++ Samples" data-via="sftrabbit" data-dnt="true">Tweet</a></p>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
				</div>
				<div class="column-1 offset-1 about">
					<img src="http://josephmansfield.uk/images/logo.svg">
					<p>C++ Samples created by <a href="http://josephmansfield.uk/">Joseph Mansfield</a></p>
				</div>
			</div>
		</footer>
		<script>
adsbygoogle = window.adsbygoogle || [];
adsbygoogle.push({});

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17335804-5', 'auto');
ga('send', 'pageview');

window.fbAsyncInit = function() {
  FB.init({
    appId      : '676162015844286',
    xfbml      : true,
    version    : 'v2.3'
  });
};

(function(d, s, id){
   var js, fjs = d.getElementsByTagName(s)[0];
   if (d.getElementById(id)) {return;}
   js = d.createElement(s); js.id = id;
   js.src = "//connect.facebook.net/en_US/sdk.js";
   fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
		</script>
	</body>
</html>
